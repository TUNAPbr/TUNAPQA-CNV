<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <link rel="stylesheet" href="css/cnv-colors.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Participante - CNV 2025 v2</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    body {
      background: linear-gradient(135deg, #2797ff 0%, #0b67bc 100%);
      min-height: 100vh;
    }
    .card-section {
      transition: all 0.3s ease;
    }
    .card-section.inactive {
      opacity: 0.5;
      pointer-events: none;
    }
  </style>
</head>

<body class="p-4">
  
  <div class="max-w-4xl mx-auto">
    <!-- ... TODO O CONTEÚDO EXISTENTE ... -->
  </div>

  <!-- SCRIPTS ORIGINAIS -->
  <script src="js/supabase-config.js"></script>
  <script src="js/enquetes-quiz-utils.js"></script>
  <script src="js/participante.js"></script>

  <!-- NOVO SCRIPT: COUNTDOWN DO QUIZ -->
  <script>
    // Variável global
    let countdownTimer = null;

    // Função de renderização da pergunta do quiz com countdown
    function renderizarPerguntaQuiz() {
      const tempoLimite = perguntaAtual.tempo_limite || 30;
      
      document.getElementById('numPergunta').textContent = 
        `${quizAtual.pergunta_atual}/${quizAtual.total_perguntas}`;
      document.getElementById('textoPerguntaQuiz').textContent = 
        perguntaAtual.pergunta;
      
      // Container do countdown
      const countdownHTML = `
        <div class="mb-4 text-center">
          <div class="inline-flex items-center gap-2 bg-cnv-warning bg-opacity-20 px-4 py-2 rounded-lg">
            <span class="text-2xl">⏱️</span>
            <span id="countdownDisplay" class="text-2xl font-bold text-cnv-warning">${tempoLimite}</span>
            <span class="text-sm text-gray-600">segundos</span>
          </div>
          <div class="mt-2 w-full bg-gray-200 rounded-full h-2">
            <div id="countdownBar" class="bg-cnv-warning h-2 rounded-full transition-all" style="width: 100%"></div>
          </div>
        </div>
      `;
      
      const opcoesContainer = document.getElementById('opcoesQuiz');
      const labels = ['A', 'B', 'C', 'D'];
      const opcoes = perguntaAtual.opcoes;
      
      opcoesContainer.innerHTML = countdownHTML + opcoes.map((opcao, idx) => `
        <button 
          onclick="responderQuizParticipante(${idx})"
          id="opcaoQuiz${idx}"
          class="w-full px-4 py-3 bg-cnv-alternate hover:bg-cnv-warning hover:text-white rounded-lg text-left transition font-medium"
        >
          <strong>${labels[idx]}.</strong> ${esc(opcao)}
        </button>
      `).join('');
      
      // Iniciar countdown
      iniciarCountdown(tempoLimite);
    }

    // Função de gerenciamento do countdown
    function iniciarCountdown(duracao) {
      // Limpar countdown anterior se existir
      if (countdownTimer) {
        countdownTimer.stop();
      }

      countdownTimer = new CountdownTimer({
        duration: duracao,
        
        onTick: (timeLeft) => {
          const display = document.getElementById('countdownDisplay');
          if (display) {
            display.textContent = timeLeft;
            if (timeLeft <= 5) {
              display.classList.add('text-red-600');
            }
          }
          
          const bar = document.getElementById('countdownBar');
          if (bar) {
            const percentage = (timeLeft / duracao) * 100;
            bar.style.width = percentage + '%';
            if (timeLeft <= 10) {
              bar.classList.remove('bg-cnv-warning');
              bar.classList.add('bg-red-500');
            }
          }
        },
        
        onComplete: () => {
          document.querySelectorAll('[id^="opcaoQuiz"]').forEach(btn => {
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
          });
          
          mostrarFeedback('feedbackQuiz', 'warning', 
            '⏰ Tempo esgotado! Aguarde a revelação da resposta.');
          
          perguntaAtual.jaRespondeu = true;
          atualizarSecaoQuiz();
        }
      });
      
      countdownTimer.start();
    }

    // Modificar função responderQuizParticipante para parar countdown
    async function responderQuizParticipante(opcaoIndex) {
      if (perguntaAtual.jaRespondeu) return;
      
      if (countdownTimer) {
        countdownTimer.stop();
      }
      
      const tempoResposta = Math.floor((Date.now() - tempoInicio) / 1000);
      
      // ... resto do código existente de envio da resposta ...
    }
  </script>

</body>
</html>
