<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link rel="stylesheet" href="css/cnv-colors.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tel√£o - CNV 2025 v2</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <style>
    body {
      background: linear-gradient(135deg, #222c3a 0%, #0b67bc 100%);
      min-height: 100vh;
      overflow: hidden;
    }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .texto-grande { font-size: clamp(2rem, 5vw, 4rem); line-height: 1.3; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
    .texto-medio { font-size: clamp(1.5rem, 3vw, 2.5rem); }

    /* Anima√ß√£o para countdown urgente */
    @keyframes pulse-urgent {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .animate-pulse-urgent {
      animation: pulse-urgent 0.5s ease-in-out infinite;
    }
    
  </style>
</head>
<body class="flex flex-col p-6">
  
  <!-- HEADER -->
  <header class="text-center mb-8">
    <h1 id="palestraTitulo" class="text-3xl md:text-5xl font-bold text-white drop-shadow-lg mb-3">
      Aguardando palestra...
    </h1>
    <div class="inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-6 py-3 rounded-full">
      <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"></path>
      </svg>
      <span id="palestrante" class="text-xl text-white font-semibold">-</span>
    </div>
  </header>
  
  <!-- LOADING -->
  <div id="loading" class="flex-1 flex items-center justify-center">
    <div class="text-center">
      <div class="inline-block animate-spin rounded-full h-16 w-16 border-b-4 border-white mb-4"></div>
      <p class="text-2xl text-white">Aguardando palestra ativa...</p>
    </div>
  </div>
  
  <!-- CONTE√öDO PRINCIPAL -->
  <main id="mainContent" class="flex-1 flex items-center justify-center px-4 hidden">
    
    <!-- MODO: SEM CONTE√öDO -->
    <div id="modoVazio" class="w-full max-w-6xl">
      <div class="bg-white/10 backdrop-blur-sm rounded-3xl p-16 border-2 border-white/20">
        <svg class="w-32 h-32 mx-auto mb-6 text-white/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
        </svg>
        <p class="text-3xl text-white/70 font-semibold text-center">
          Aguardando conte√∫do...
        </p>
      </div>
    </div>
    
    <!-- MODO: PERGUNTA -->
    <div id="modoPergunta" class="w-full max-w-6xl hidden">
      <div class="mb-4">
        <span class="inline-block bg-white/20 text-white px-6 py-2 rounded-full text-lg font-semibold backdrop-blur-sm">
          üìå PERGUNTA
        </span>
      </div>
      
      <div class="bg-white rounded-3xl shadow-2xl p-12 mb-8 fade-in">
        <p id="textoPergunta" class="texto-grande text-gray-800 font-bold text-center mb-6"></p>
        <div id="nomePergunta" class="text-center text-gray-600 text-2xl"></div>
      </div>
    </div>
    
    <!-- MODO: ENQUETE -->
    <div id="modoEnquete" class="w-full max-w-6xl hidden">
      <div class="mb-4">
        <span class="inline-block bg-green-500 text-white px-6 py-2 rounded-full text-lg font-semibold backdrop-blur-sm">
          üìä ENQUETE ATIVA
        </span>
      </div>
      
      <div class="bg-white rounded-3xl shadow-2xl p-12 fade-in text-center">
        <h2 id="tituloEnquete" class="texto-medio text-gray-800 font-bold mb-6"></h2>
        <p class="text-2xl text-gray-600">üì± Vote no seu dispositivo!</p>
      </div>
    </div>
    
    <!-- MODO: QUIZ -->
    <div id="modoQuiz" class="w-full max-w-6xl hidden">
      <div class="mb-4">
        <span class="inline-block bg-yellow-500 text-white px-6 py-2 rounded-full text-lg font-semibold backdrop-blur-sm" id="progressoQuiz">
          üéÆ QUIZ
        </span>
      </div>
      
      <!-- Pergunta do Quiz -->
      <div id="quizPergunta" class="bg-white rounded-3xl shadow-2xl p-12 fade-in">
        <p id="textoQuizPergunta" class="texto-medio text-gray-800 font-bold text-center mb-8"></p>
        <p class="text-xl text-gray-600 text-center">üì± Responda no seu dispositivo!</p>
      </div>
      
      <!-- Resultado do Quiz -->
      <div id="quizResultado" class="hidden bg-white rounded-3xl shadow-2xl p-12 fade-in">
        <div class="text-center mb-6">
          <p class="text-2xl text-gray-600 mb-2">Resposta Correta:</p>
          <p id="respostaCorreta" class="text-5xl font-bold text-green-600 mb-6"></p>
        </div>
        <div class="mb-6">
          <canvas id="chartQuizTelao" height="200"></canvas>
        </div>
        <div class="text-center">
          <p class="text-3xl font-bold text-blue-600" id="percentualAcerto"></p>
        </div>
      </div>
    </div>
    
  </main>
  
  <!-- FOOTER -->
  <footer class="text-center">
    <div class="inline-block bg-white/10 backdrop-blur-sm rounded-full px-8 py-3">
      <p class="text-white text-lg"><strong>CNV 2025</strong></p>
    </div>
    <div class="inline-block bg-white/10 backdrop-blur-sm rounded-full px-8 py-3">
      <p class="text-white text-lg"><strong>by TUNAP Labs</strong></p>
    </div>
  </footer>
  
  <script src="js/supabase-config.js"></script>
  <script src="js/enquetes-quiz-utils.js"></script>
  <script src="js/telao.js"></script>

  <!-- NOVO SCRIPT: COUNTDOWN DO TEL√ÉO -->
  <script>
    // Vari√°vel global para countdown no tel√£o
    let telaoCountdown = null;

    // Sobrescreve/estende a exibi√ß√£o do quiz incluindo o countdown gigante
    function exibirQuiz() {
      document.getElementById('modoQuiz').classList.remove('hidden');
      document.getElementById('progressoQuiz').textContent =
        `üéÆ QUIZ - Pergunta ${quizAtivo.pergunta_atual}/${quizAtivo.total_perguntas}`;
      
      if (perguntaAtualQuiz.revelada) {
        // Mostrar resultado (comportamento existente)
        document.getElementById('quizPergunta').classList.add('hidden');
        document.getElementById('quizResultado').classList.remove('hidden');
      } else {
        // Mostrar pergunta com countdown
        document.getElementById('quizPergunta').classList.remove('hidden');
        document.getElementById('quizResultado').classList.add('hidden');

        const tempoLimite = perguntaAtualQuiz.tempo_limite || 30;
        document.getElementById('textoQuizPergunta').textContent = perguntaAtualQuiz.pergunta;

        // Bloco visual do countdown grande
        const countdownHTML = `
          <div class="mt-8 text-center">
            <div class="inline-flex flex-col items-center justify-center w-32 h-32 rounded-full border-8 border-white bg-white/10 backdrop-blur">
              <span id="telaoCountdownDisplay" class="text-5xl font-bold text-white">${tempoLimite}</span>
              <span class="text-sm text-white/70">segundos</span>
            </div>
          </div>
        `;

        const container = document.getElementById('quizPergunta');
        if (!document.getElementById('telaoCountdownDisplay')) {
          container.insertAdjacentHTML('beforeend', countdownHTML);
        }

        // Iniciar countdown do tel√£o
        iniciarCountdownTelao(tempoLimite);
      }
    }

    // Gerencia o countdown do tel√£o usando CountdownTimer utilit√°rio
    function iniciarCountdownTelao(duracao) {
      if (telaoCountdown) {
        telaoCountdown.stop();
      }
      
      telaoCountdown = new CountdownTimer({
        duration: duracao,
        onTick: (timeLeft) => {
          const display = document.getElementById('telaoCountdownDisplay');
          if (display) {
            display.textContent = timeLeft;

            // Pulsar nos √∫ltimos 10s
            if (timeLeft <= 10) {
              display.classList.add('animate-pulse', 'text-red-400');
            }
            // Urg√™ncia nos √∫ltimos 5s
            if (timeLeft <= 5) {
              display.classList.add('text-red-600', 'scale-110');
            }
          }
        },
        onComplete: () => {
          const display = document.getElementById('telaoCountdownDisplay');
          if (display) {
            display.textContent = '‚è∞';
            display.parentElement.classList.add('bg-red-500');
          }
        }
      });

      telaoCountdown.start();
    }
  </script>
</body>
</html>
